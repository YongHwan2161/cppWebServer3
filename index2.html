<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Document Title</title>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        #clock {
            color: green;
            display: inline-block;
        }

        #loginForm {
            width: 300px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f2f2f2;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #loginForm div {
            margin-bottom: 15px;
        }

        #loginForm label {
            display: block;
            margin-bottom: 5px;
        }

        #loginForm input[type="text"],
        #loginForm input[type="password"] {
            width: calc(100% - 10px);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #loginForm button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: #fff;
            cursor: pointer;
        }

        #loginForm button[type="submit"] {
            background-color: #28a745;
        }

        #loginForm button[type="submit"]:hover,
        #loginForm button[type="button"]:hover {
            background-color: #0056b3;
        }

        #filecontent {
            display: none;
        }

        #saveFileChanges {
            display: none;
        }

        #contents,
        #info {
            display: inline-block;
            max-width: 500px;
            overflow-wrap: break-word;
        }

        textarea {
            width: 40%;
            margin-bottom: 10px;
        }

        .button {
            background-color: #007bff;
            border: none;
            color: white;
            padding: 2px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 11px;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 1px;
        }

        .button:hover {
            background-color: #0056b3;
        }

        .home-button {
            display: inline-block;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 15px;
            text-align: center;
            line-height: 30px;
            text-decoration: none;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
        }

        .home-button:hover {
            background-color: #0056b3;
        }

        canvas {
            width: 100vw;
            height: 100vh;
            display: block;
        }

        #ui {
            width: 200px;
        }
    </style>
</head>

<body onload="start()">
    <!-- 홈 버튼 -->
    <a href="#" class="home-button" onclick="sendTextToServer('start')"><i class="fas fa-home"></i></a>
    <div id="clock"></div><br />
    <form id="loginForm">
        <div>
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <div>
            <button type="submit">Login</button>
            <button type="button" onclick="location.href='/signup.html'">Sign Up</button>
        </div>
    </form>
    <div id="contents"></div><br />
    <textarea id="textinput" placeholder="Enter text..."></textarea><br />
    <button class="button" id="Button_Save" onclick="sendTextToServer('save')">Save</button>
    <button class="button" id="Button_Enter"
        onclick="sendTextToServer(document.getElementById('textinput').value)">Enter</button>
    <button class="button" id="Button_Review" onclick="sendTextToServer('98')">Review</button><br />
    <div id="info"></div><br />
    <div id="Log"></div><br />
    <textarea id="fileContent" rows="1"></textarea><br />
    <button id="saveFileChanges" onclick="saveFileChanges()">Save Changes</button>
    <canvas id="c"></canvas>
    <div id="uiContainer">
        <div id="ui">
            <div id="x"></div>
            <div id="y"></div>
            <div id="z"></div>
            <div id="angleX"></div>
            <div id="angleY"></div>
            <div id="angleZ"></div>
            <div id="scaleX"></div>
            <div id="scaleY"></div>
            <div id="scaleZ"></div>
        </div>
    </div>
    <script id="vertex-shader-2d" type="notjs">

    // an attribute will receive data from a buffer
    attribute vec4 a_position;
    uniform mat4 u_matrix;
    
    // all shaders have a main function
    void main() {
        // 위치에 행렬 곱하기
        gl_Position = u_matrix * a_position;
    }
  
  </script>
    <script id="fragment-shader-2d" type="notjs">

    // fragment shaders don't have a default precision so we need
    // to pick one. mediump is a good default
    precision mediump float;
    uniform vec4 u_color;
    
    void main() {
        gl_FragColor = u_color;
      }
  
  </script>
    </script>
    <!--
  for most samples webgl-utils only provides shader compiling/linking and
  canvas resizing because why clutter the examples with code that's the same in every sample.
  See https://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html
  and https://webglfundamentals.org/webgl/lessons/webgl-resizing-the-canvas.html
  for webgl-utils, m3, m4, and webgl-lessons-ui.
  -->
    <script src="https://webglfundamentals.org/webgl/resources/webgl-utils.js"></script>
    <script src="https://webglfundamentals.org/webgl/resources/webgl-lessons-ui.js"></script>

    <script>
        let user = 0, node = 0, ch = 0;
        function updateClock() {
            document.getElementById("clock").textContent = new Date().toLocaleTimeString();
        }

        function sendTextToServer(textinput) {
            //const textinput = document.getElementById("textinput").value;
            const fileContent = document.getElementById('fileContent').value;
            const additionalContent = textinput === "editHtml" ? `\t${fileContent}` : (textinput === "editcppl" ? `\t${fileContent}` : '');
            const text = `${user}\t${node}\t${ch}\t${textinput}${additionalContent}`;

            const xhr = new XMLHttpRequest();
            xhr.open('POST', 'https://obscure-space-train-v9xrjvg795p2rx5-8080.app.github.dev/', true);
            xhr.setRequestHeader('Content-Type', 'text/plain; charset=utf-8');
            xhr.onload = function () {
                if (xhr.status === 200) {
                    const res = xhr.responseText.split('\t');
                    updateUI(res);
                } else {
                    console.error('Error:', xhr.status, xhr.statusText);
                    document.getElementById("contents").textContent = `An error occurred: ${xhr.status} ${xhr.statusText}`;
                }
            };
            xhr.onerror = function () {
                console.error('Request failed.');
            };
            xhr.send(text);
            document.getElementById("textinput").focus();
        }
        function updateUI(res) {
            user = res[0];
            node = res[1];
            ch = res[2];
            const contents = document.getElementById("contents");
            const info = document.getElementById("info");
            if (res[5] === "html") {
                document.getElementById('fileContent').value = res[3];
            } else if (res[5] === "cpp") {
                document.getElementById('fileContent').value = res[3];
            } else {
                contents.innerHTML = res[3];
            }
            info.textContent = `user: ${res[0]}, node: ${res[1]}/${res[4]}, ch: ${res[2]}, Last: ${res[6]}`;
            document.getElementById("textinput").value = res[5];
            console.log(res);
        }
        function saveFileChanges() {
            if (document.getElementById("textinput").value === "html") {
                document.getElementById("textinput").value = "editHtml";
            } else {
                document.getElementById("textinput").value = "editcpp";
            }
            sendTextToServer();
            //location.reload();
        }
        window.onload = function () {
            document.getElementById('Log').innerText = 'Page is fully loaded.';
            updateClock();
            setInterval(updateClock, 1000);
            sendTextToServer();
        }
        document.getElementById("loginForm").addEventListener("submit", function (event) {
            event.preventDefault(); // Prevent the form from submitting

            var formData = new FormData(this); // Collect form data

            fetch("/login", {
                method: "POST",
                body: formData
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    // Handle successful login response
                    const res = data.split('\t');
                    updateUI(res);
                    // Hide the login form
                    document.getElementById("loginForm").style.display = "none";
                    //console.log(data); // Do whatever processing you need with the response data
                })
                .catch(error => {
                    // Handle error
                    console.error('There was a problem with the fetch operation:', error);
                });
        });

        /* eslint no-console:0 consistent-return:0 */
        "use strict";

        function main() {
            // Get A WebGL context
            /** @type {HTMLCanvasElement} */
            var canvas = document.querySelector("#c");
            var gl = canvas.getContext("webgl");
            if (!gl) {
                return;
            }

            // setup GLSL program
            var program = webglUtils.createProgramFromScripts(gl, ["vertex-shader-2d", "fragment-shader-2d"]);
            gl.useProgram(program);

            // look up where the vertex data needs to go.
            var positionLocation = gl.getAttribLocation(program, "a_position");
            var colorLocation = gl.getUniformLocation(program, "u_color");
            var matrixLocation = gl.getUniformLocation(program, "u_matrix");

            // Create a buffer to put positions in
            var positionBuffer = gl.createBuffer();
            // Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            // Put geometry data into buffer
            setGeometry(gl);
            function radToDeg(r) {
    return r * 180 / Math.PI;
  }

  function degToRad(d) {
    return d * Math.PI / 180;
  }
            var translation = [0, 0];
            var color = [Math.random(), Math.random(), Math.random(), 1];
  var rotation = [degToRad(40), degToRad(25), degToRad(325)];
            var scale = [1, 1];

            drawScene();

            // Setup a ui.
            webglLessonsUI.setupSlider("#x", {value: translation[0], slide: updatePosition(0), max: gl.canvas.width });
  webglLessonsUI.setupSlider("#y", {value: translation[1], slide: updatePosition(1), max: gl.canvas.height});
  webglLessonsUI.setupSlider("#z", {value: translation[2], slide: updatePosition(2), max: gl.canvas.height});
  webglLessonsUI.setupSlider("#angleX", {value: radToDeg(rotation[0]), slide: updateRotation(0), max: 360});
  webglLessonsUI.setupSlider("#angleY", {value: radToDeg(rotation[1]), slide: updateRotation(1), max: 360});
  webglLessonsUI.setupSlider("#angleZ", {value: radToDeg(rotation[2]), slide: updateRotation(2), max: 360});
  webglLessonsUI.setupSlider("#scaleX", {value: scale[0], slide: updateScale(0), min: -5, max: 5, step: 0.01, precision: 2});
  webglLessonsUI.setupSlider("#scaleY", {value: scale[1], slide: updateScale(1), min: -5, max: 5, step: 0.01, precision: 2});
  webglLessonsUI.setupSlider("#scaleZ", {value: scale[2], slide: updateScale(2), min: -5, max: 5, step: 0.01, precision: 2});


            function updatePosition(index) {
                return function (event, ui) {
                    translation[index] = ui.value;
                    drawScene();
                };
            }
            function updateRotation(index) {
    return function(event, ui) {
      var angleInDegrees = ui.value;
      var angleInRadians = angleInDegrees * Math.PI / 180;
      rotation[index] = angleInRadians;
      drawScene();
    };
  }
            function updateScale(index) {
                return function (event, ui) {
                    scale[index] = ui.value;
                    drawScene();
                };
            }
            // Draw the scene.
            function drawScene() {
                webglUtils.resizeCanvasToDisplaySize(gl.canvas);

                // Tell WebGL how to convert from clip space to pixels
                gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

                // Clear the canvas.
                gl.clear(gl.COLOR_BUFFER_BIT);

                // Tell it to use our program (pair of shaders)
                gl.useProgram(program);

                // Turn on the attribute
                gl.enableVertexAttribArray(positionLocation);

                // Bind the position buffer.
                gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);

                // Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)
                var size = 3;          // 2 components per iteration
                var type = gl.FLOAT;   // the data is 32bit floats
                var normalize = false; // don't normalize the data
                var stride = 0;        // 0 = move forward size * sizeof(type) each iteration to get the next position
                var offset = 0;        // start at the beginning of the buffer
                gl.vertexAttribPointer(
                    positionLocation, size, type, normalize, stride, offset);

                // set the color
                gl.uniform4fv(colorLocation, color);

  // 행렬 계산
  var matrix = m4.projection(gl.canvas.clientWidth, gl.canvas.clientHeight, 400);
  matrix = m4.translate(matrix, translation[0], translation[1], translation[2]);
  matrix = m4.xRotate(matrix, rotation[0]);
  matrix = m4.yRotate(matrix, rotation[1]);
  matrix = m4.zRotate(matrix, rotation[2]);
  matrix = m4.scale(matrix, scale[0], scale[1], scale[2]);

                // Set the matrix.
                gl.uniformMatrix4fv(matrixLocation, false, matrix);

                // Draw the geometry.
                var primitiveType = gl.TRIANGLES;
                var offset = 0;
                var count = 18;  // 6 triangles in the 'F', 3 points per triangle
                gl.drawArrays(primitiveType, offset, count);
            }
        }
        var m3 = {
            projection: function (width, height) {
                // 참고: 이 행렬은 Y축을 뒤집어서 0이 위쪽에 있도록 합니다.
                return [
                    2 / width, 0, 0,
                    0, -2 / height, 0,
                    -1, 1, 1
                ];
            },
            identity: function () {
                return [
                    1, 0, 0,
                    0, 1, 0,
                    0, 0, 1,
                ];
            },
            translation: function (tx, ty) {
                return [
                    1, 0, 0,
                    0, 1, 0,
                    tx, ty, 1,
                ];
            },

            rotation: function (angleInRadians) {
                var c = Math.cos(angleInRadians);
                var s = Math.sin(angleInRadians);
                return [
                    c, -s, 0,
                    s, c, 0,
                    0, 0, 1,
                ];
            },

            scaling: function (sx, sy) {
                return [
                    sx, 0, 0,
                    0, sy, 0,
                    0, 0, 1,
                ];
            },
            translate: function (m, tx, ty) {
                return m3.multiply(m, m3.translation(tx, ty));
            },

            rotate: function (m, angleInRadians) {
                return m3.multiply(m, m3.rotation(angleInRadians));
            },

            scale: function (m, sx, sy) {
                return m3.multiply(m, m3.scaling(sx, sy));
            },

            multiply: function (a, b) {
                var a00 = a[0 * 3 + 0];
                var a01 = a[0 * 3 + 1];
                var a02 = a[0 * 3 + 2];
                var a10 = a[1 * 3 + 0];
                var a11 = a[1 * 3 + 1];
                var a12 = a[1 * 3 + 2];
                var a20 = a[2 * 3 + 0];
                var a21 = a[2 * 3 + 1];
                var a22 = a[2 * 3 + 2];
                var b00 = b[0 * 3 + 0];
                var b01 = b[0 * 3 + 1];
                var b02 = b[0 * 3 + 2];
                var b10 = b[1 * 3 + 0];
                var b11 = b[1 * 3 + 1];
                var b12 = b[1 * 3 + 2];
                var b20 = b[2 * 3 + 0];
                var b21 = b[2 * 3 + 1];
                var b22 = b[2 * 3 + 2];
                return [
                    b00 * a00 + b01 * a10 + b02 * a20,
                    b00 * a01 + b01 * a11 + b02 * a21,
                    b00 * a02 + b01 * a12 + b02 * a22,
                    b10 * a00 + b11 * a10 + b12 * a20,
                    b10 * a01 + b11 * a11 + b12 * a21,
                    b10 * a02 + b11 * a12 + b12 * a22,
                    b20 * a00 + b21 * a10 + b22 * a20,
                    b20 * a01 + b21 * a11 + b22 * a21,
                    b20 * a02 + b21 * a12 + b22 * a22,
                ];
            },
        };
        var m4 = {
            projection: function(width, height, depth) {
    // 참고: 이 행렬은 Y축을 뒤집기 때문에 0이 상단입니다.
    return [
       2 / width, 0, 0, 0,
       0, -2 / height, 0, 0,
       0, 0, 2 / depth, 0,
      -1, 1, 0, 1,
    ];
  },
            translation: function (tx, ty, tz) {
                return [
                    1, 0, 0, 0,
                    0, 1, 0, 0,
                    0, 0, 1, 0,
                    tx, ty, tz, 1,
                ];
            },

            xRotation: function (angleInRadians) {
                var c = Math.cos(angleInRadians);
                var s = Math.sin(angleInRadians);

                return [
                    1, 0, 0, 0,
                    0, c, s, 0,
                    0, -s, c, 0,
                    0, 0, 0, 1,
                ];
            },

            yRotation: function (angleInRadians) {
                var c = Math.cos(angleInRadians);
                var s = Math.sin(angleInRadians);

                return [
                    c, 0, -s, 0,
                    0, 1, 0, 0,
                    s, 0, c, 0,
                    0, 0, 0, 1,
                ];
            },

            zRotation: function (angleInRadians) {
                var c = Math.cos(angleInRadians);
                var s = Math.sin(angleInRadians);

                return [
                    c, s, 0, 0,
                    -s, c, 0, 0,
                    0, 0, 1, 0,
                    0, 0, 0, 1,
                ];
            },

            scaling: function (sx, sy, sz) {
                return [
                    sx, 0, 0, 0,
                    0, sy, 0, 0,
                    0, 0, sz, 0,
                    0, 0, 0, 1,
                ];
            },
            translate: function (m, tx, ty, tz) {
                return m4.multiply(m, m4.translation(tx, ty, tz));
            },

            xRotate: function (m, angleInRadians) {
                return m4.multiply(m, m4.xRotation(angleInRadians));
            },

            yRotate: function (m, angleInRadians) {
                return m4.multiply(m, m4.yRotation(angleInRadians));
            },

            zRotate: function (m, angleInRadians) {
                return m4.multiply(m, m4.zRotation(angleInRadians));
            },

            scale: function (m, sx, sy, sz) {
                return m4.multiply(m, m4.scaling(sx, sy, sz));
            },
            multiply: function (a, b) {
                var b00 = b[0 * 4 + 0];
                var b01 = b[0 * 4 + 1];
                var b02 = b[0 * 4 + 2];
                var b03 = b[0 * 4 + 3];
                var b10 = b[1 * 4 + 0];
                var b11 = b[1 * 4 + 1];
                var b12 = b[1 * 4 + 2];
                var b13 = b[1 * 4 + 3];
                var b20 = b[2 * 4 + 0];
                var b21 = b[2 * 4 + 1];
                var b22 = b[2 * 4 + 2];
                var b23 = b[2 * 4 + 3];
                var b30 = b[3 * 4 + 0];
                var b31 = b[3 * 4 + 1];
                var b32 = b[3 * 4 + 2];
                var b33 = b[3 * 4 + 3];
                var a00 = a[0 * 4 + 0];
                var a01 = a[0 * 4 + 1];
                var a02 = a[0 * 4 + 2];
                var a03 = a[0 * 4 + 3];
                var a10 = a[1 * 4 + 0];
                var a11 = a[1 * 4 + 1];
                var a12 = a[1 * 4 + 2];
                var a13 = a[1 * 4 + 3];
                var a20 = a[2 * 4 + 0];
                var a21 = a[2 * 4 + 1];
                var a22 = a[2 * 4 + 2];
                var a23 = a[2 * 4 + 3];
                var a30 = a[3 * 4 + 0];
                var a31 = a[3 * 4 + 1];
                var a32 = a[3 * 4 + 2];
                var a33 = a[3 * 4 + 3];

                return [
                    b00 * a00 + b01 * a10 + b02 * a20 + b03 * a30,
                    b00 * a01 + b01 * a11 + b02 * a21 + b03 * a31,
                    b00 * a02 + b01 * a12 + b02 * a22 + b03 * a32,
                    b00 * a03 + b01 * a13 + b02 * a23 + b03 * a33,
                    b10 * a00 + b11 * a10 + b12 * a20 + b13 * a30,
                    b10 * a01 + b11 * a11 + b12 * a21 + b13 * a31,
                    b10 * a02 + b11 * a12 + b12 * a22 + b13 * a32,
                    b10 * a03 + b11 * a13 + b12 * a23 + b13 * a33,
                    b20 * a00 + b21 * a10 + b22 * a20 + b23 * a30,
                    b20 * a01 + b21 * a11 + b22 * a21 + b23 * a31,
                    b20 * a02 + b21 * a12 + b22 * a22 + b23 * a32,
                    b20 * a03 + b21 * a13 + b22 * a23 + b23 * a33,
                    b30 * a00 + b31 * a10 + b32 * a20 + b33 * a30,
                    b30 * a01 + b31 * a11 + b32 * a21 + b33 * a31,
                    b30 * a02 + b31 * a12 + b32 * a22 + b33 * a32,
                    b30 * a03 + b31 * a13 + b32 * a23 + b33 * a33,
                ];
            },
        };
        // Fill the buffer with the values that define a letter 'F'.
        function setGeometry(gl) {
            gl.bufferData(
                gl.ARRAY_BUFFER,
                new Float32Array([
                    // left column
                    0, 0,
                    30, 0,
                    0, 150,
                    0, 150,
                    30, 0,
                    30, 150,

                    // top rung
                    30, 0,
                    100, 0,
                    30, 30,
                    30, 30,
                    100, 0,
                    100, 30,

                    // middle rung
                    30, 60,
                    67, 60,
                    30, 90,
                    30, 90,
                    67, 60,
                    67, 90,
                ]),
                gl.STATIC_DRAW);
        }

        main();

    </script>
</body>

</html>